import React,{useEffect, useState} from 'react'
import useFetch from 'hooks/useFetch'

import CommentItem from 'components/commentItem'

const CommentsList = ({slug, newComment}) => {
  const apiUrl = `/articles/${slug}/comments`
  const [{ response }, doFetch] = useFetch(apiUrl);
  const [deleteCommentId, setDeleteCommentId] = useState('')
  const deleteApiUrl = `/articles/${slug}/comments/${deleteCommentId}`
  const [{ deleteResponse,deleteError }, doDeleteFetch] = useFetch(deleteApiUrl)
  let comments = []

  if (response) { 
    comments = response.comments
  } 
  
  const handleDelete = id => {
    setDeleteCommentId(id)
    doFetch()
  }

  useEffect(() => {
    doDeleteFetch({
      method: 'delete'
    })
  }, [deleteCommentId]);

    
  useEffect(() => {
		doFetch()
  }, [doFetch, newComment, deleteCommentId]);


  if (!response) {
    return null
  }
  return (
    <>
      {comments.map(comment => {
        return <CommentItem key={comment.id} {...comment} handleDelete={handleDelete}/>
      })}
    </>
  )
}

export default CommentsList

